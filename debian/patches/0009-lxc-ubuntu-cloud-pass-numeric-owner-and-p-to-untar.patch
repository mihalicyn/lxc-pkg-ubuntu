From 494fd6b390ecae077375e171230ce78d6784dd43 Mon Sep 17 00:00:00 2001
From: Scott Moser <smoser@ubuntu.com>
Date: Mon, 7 Oct 2013 20:41:23 -0400
Subject: [PATCH] lxc-ubuntu-cloud: pass --numeric-owner and -p to untar
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Just following up here, Serge raised the question of whether or not the
other two invocations of 'tar' in this script need '--numeric-owner'.
They probably should have it, although its of little concern because the
'build_root_tgz' path is only taken if there is no '-root.tar.gz' file for
download, and the only supported ubuntu release without the -root.tar.gz
download is 10.04 at this point.

Anyway, below is a more complete diff, also including a fix as
'--numeric-uid' is not a valid option to tar.  The name is
'--numeric-owner'.

Signed-off-by: Scott Moser <smoser@ubuntu.com>
Acked-by: St√©phane Graber <stgraber@ubuntu.com>
---
 templates/lxc-ubuntu-cloud.in | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/templates/lxc-ubuntu-cloud.in b/templates/lxc-ubuntu-cloud.in
index 47a5fca..a2af003 100644
--- a/templates/lxc-ubuntu-cloud.in
+++ b/templates/lxc-ubuntu-cloud.in
@@ -340,7 +340,7 @@ build_root_tgz()
     echo "Creating new cached cloud image rootfs"
     tar --wildcards -zxf $tarname $imgname
     mount -o loop $imgname $xdir
-    (cd $xdir; tar zcf ../$filename .)
+    (cd $xdir; tar --numeric-owner -cpzf ../$filename .)
     umount $xdir
     rm -f $tarname $imgname
     rmdir $xdir
@@ -371,7 +371,7 @@ do_extract_rootfs() {
     echo "Extracting container rootfs"
     mkdir -p $rootfs
     cd $rootfs
-    tar -zxf $cache/$filename
+    tar --numeric-owner -xpzf $cache/$filename
 }
 
 if [ -n "$tarball" ]; then
-- 
1.8.3.2

