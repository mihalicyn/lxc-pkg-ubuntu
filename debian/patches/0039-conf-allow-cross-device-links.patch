From 4a66dabf86ed1a0f210a23371126f27df6929eb7 Mon Sep 17 00:00:00 2001
From: Christian Brauner <brauner@kernel.org>
Date: Wed, 14 Sep 2022 16:21:20 +0200
Subject: [PATCH 39/45] conf: allow cross-device links

Fixes: https://github.com/lxc/lxd/issues/10914
Signed-off-by: Christian Brauner (Microsoft) <christian.brauner@ubuntu.com>
---
 src/lxc/conf.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/lxc/conf.c b/src/lxc/conf.c
index a04bb0de8..bc1b25464 100644
--- a/src/lxc/conf.c
+++ b/src/lxc/conf.c
@@ -3041,7 +3041,7 @@ static int __lxc_idmapped_mounts_child(struct lxc_handler *handler, FILE *f)
 			dfd_from = rootfs->dfd_mnt;
 		else
 			dfd_from = rootfs->dfd_host;
-		fd_to = open_at(dfd_from, target_relative, PROTECT_OPATH_FILE, PROTECT_LOOKUP_BENEATH_WITH_SYMLINKS, 0);
+		fd_to = open_at(dfd_from, target_relative, PROTECT_OPATH_FILE, PROTECT_LOOKUP_BENEATH_XDEV, 0);
 		if (fd_to < 0) {
 			if (opts.optional) {
 				TRACE("Skipping optional idmapped mount");
-- 
2.37.2

