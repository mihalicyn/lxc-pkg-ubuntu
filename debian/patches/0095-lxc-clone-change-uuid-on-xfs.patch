From ccdfabfc11d0620038b7517ab35a673bf3241771 Mon Sep 17 00:00:00 2001
From: Serge Hallyn <serge.hallyn@ubuntu.com>
Date: Thu, 12 Jul 2012 16:33:14 -0500
Subject: [PATCH 1/1] lxc-clone: change uuid on xfs

Signed-off-by: Serge Hallyn <serge.hallyn@ubuntu.com>
---
 src/lxc/lxc-clone.in |    8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

Index: lxc/src/lxc/lxc-clone.in
===================================================================
--- lxc.orig/src/lxc/lxc-clone.in	2012-07-26 17:38:04.928037000 +0000
+++ lxc/src/lxc/lxc-clone.in	2012-07-26 17:44:13.953353607 +0000
@@ -207,7 +207,13 @@
     if [ $lxc_size = "_unset" ]; then
         lxc_size=`lvdisplay $oldroot | grep Size | awk '{ print $3 $4 }'`
     fi
-    lvcreate -s -L $lxc_size -n ${lxc_lv_prefix}${lxc_new}_snapshot $oldroot
+    newlv="${lxc_lv_prefix}${lxc_new}_snapshot"
+    lvcreate -s -L $lxc_size -n $newlv $oldroot
+    type xfs_admin > /dev/null 2>&1 && {
+        # change filesystem UUID if it is an xfs filesystem
+        xfs_admin -u /dev/$lxc_vg/$newlv && xfs_admin -U generate /dev/$lxc_vg/$newlv
+    }
+	     
     if [ $container_running = "True" ]; then
         lxc-unfreeze -n $lxc_orig
         frozen=0
